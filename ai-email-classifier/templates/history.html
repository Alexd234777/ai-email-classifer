{% extends "base.html" %}
{% block content %}

<!-- SEARCH BAR -->
<form class="history-search" method="GET" action="{{ url_for('history_view') }}">
    <input type="text" name="q" placeholder="Search text..." value="{{ search or '' }}">
</form>

<!-- FILTER BUTTONS -->
<div class="filter-buttons">
    <a href="{{ url_for('history_view') }}" 
       class="filter-btn {% if not active_filter %}active{% endif %}">
        All
    </a>

    <a href="{{ url_for('history_view', label='aggressive') }}"
       class="filter-btn {% if active_filter == 'aggressive' %}active{% endif %}">
        Aggressive
    </a>

    <a href="{{ url_for('history_view', label='neutral') }}"
       class="filter-btn {% if active_filter == 'neutral' %}active{% endif %}">
        Neutral
    </a>

    <a href="{{ url_for('history_view', label='polite') }}"
       class="filter-btn {% if active_filter == 'polite' %}active{% endif %}">
        Polite
    </a>

    <a href="{{ url_for('history_view', label='friendly') }}"
       class="filter-btn {% if active_filter == 'friendly' %}active{% endif %}">
        Friendly
    </a>
</div>

<!-- ACTION BUTTONS -->
<div class="history-actions">
    <a class="btn-secondary" href="{{ url_for('export_csv') }}">Export CSV</a>
    <a class="btn-secondary" href="{{ url_for('export_pdf') }}">Export PDF</a>

    <form method="POST" action="{{ url_for('clear_history') }}">
        <button class="btn-danger" onclick="return confirm('Clear all history?')">
            Clear History
        </button>
    </form>
</div>

<!-- TABLE -->
<div class="card">
    <h2>Analysis History</h2>

    {% if history %}
    <div class="table-wrapper">
        <table class="table">
            <tr>
                <th>Time</th>
                <th>Label</th>
                <th>Severity</th>
                <th>Scores</th>
                <th>Text</th>
            </tr>

            {% for h in history %}
            <tr>
                <td>{{ h.created_at }}</td>

                <td>
                    {% if h.label == "Aggressive" %}
                        <span class="chip red">Aggressive</span>
                    {% elif h.label == "Polite" %}
                        <span class="chip green">Polite</span>
                    {% elif h.label == "Friendly" %}
                        <span class="chip blue">Friendly</span>
                    {% else %}
                        {{ h.label }}
                    {% endif %}
                </td>

                <td>{{ h.severity }}</td>

                <td>
                    Threat: {{ h.threat_score }}<br>
                    Polite: {{ h.politeness_score }}<br>
                    Friendly: {{ h.friendly_score }}
                </td>

                <td style="max-width: 500px;">
                    {{ h.text }}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% else %}
        <p class="empty">No history yet.</p>
    {% endif %}

</div>

{% endblock %}



